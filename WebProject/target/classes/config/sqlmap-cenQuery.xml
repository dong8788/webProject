<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="CenQueryDao">
	
	<!-- 중복되는 동적 SQL문에 대한 처리 -->
	<sql id="search">
		<!-- 동적 SQL 구문 -->
		<if test="condition == 'title'">
			AND cenquery.TITLE LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test="condition == 'content'">
			AND cenquery.CONTENT LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test="condition == 'reply'">
			AND cenquery.REPLY LIKE CONCAT('%', #{keyword}, '%')
		</if>
	</sql>
	
	<insert id="insert" parameterType="CenQueryVo">
		INSERT INTO CENQUERY
		(CENQUERYSEQ, OPEN, QUERYTYPE, CUSSEQ, SELLERSEQ CONTENT, TITLE, REPLY)
		VALUES (cenQuerySeq.nextval, #{open}, #{queryType}, #{cusSeq}, #{sellerSeq} #{content}, #{title}, #{reply})
	</insert>
	
	<select id="list" parameterType="SearchVO" resultType="UserCenQueryVo">
		SELECT * FROM (
		SELECT ROW_NUMBER() OVER(ORDER BY CENQUERYSEQ DESC) AS RNUM, cenquery.CENQUERYSEQ, cenquery.OPEN, cenquery.QUERYTYPE, cenquery.CUSSEQ, cenquery.SELLERSEQ, cenquery.CONTENT, cenquery.TITLE, cenquery.REGDATE, 
		cenquery.REPLY, cus.CUSID, seller.BUSINESSNAME, seller.ID 
		FROM CENQUERY cenquery, CUSTOMER cus, SELLER seller WHERE cenquery.CUSSEQ = cus.CUSSEQ OR cenquery.SELLERSEQ = seller.SELLERSEQ
		<include refid="search"/>
		) WHERE RNUM between #{rowStart} and #{rowEnd}
		
	</select>
	
	<select id="listCount" resultType="int">
		SELECT COUNT(*) FROM (
		SELECT cenquery.CENQUERYSEQ, cenquery.OPEN, cenquery.QUERYTYPE, cenquery.CUSSEQ, cenquery.SELLERSEQ, cenquery.CONTENT, cenquery.TITLE, cenquery.REGDATE, 
		cenquery.REPLY, cus.CUSID, seller.BUSINESSNAME, seller.ID 
		FROM CENQUERY cenquery, CUSTOMER cus, SELLER seller WHERE cenquery.CUSSEQ = cus.CUSSEQ OR cenquery.SELLERSEQ = seller.SELLERSEQ
		<include refid="search"/>
		)
	</select>

	<select id="listByOpen" resultType="CenQueryVo">
		SELECT *
		FROM CENQUERY
		WHERE OPEN = '공개글'
	</select>

	<select id="read" parameterType="int" resultType="CenQueryVo">
		SELECT *
		FROM CENQUERY
		WHERE CENQUERYSEQ=#{cenQuerySeq} 
	</select>

	<update id="update" parameterType="CenQueryVo">
		UPDATE CENQUERY
		SET QUERYTYPE=#{queryType}, CONTENT=#{content}, TITLE=#{title}, REPLY=#{reply}
		WHERE CENQUERYSEQ=#{cenQuerySeq} 
	</update>

	<delete id="delete" parameterType="CenQueryVo">
		DELETE FROM CENQUERY
		WHERE CENQUERYSEQ=#{cenQuerySeq} 
	</delete>


</mapper>